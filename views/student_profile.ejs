<%- include('layouts/header'); -%>
<%- include('layouts/navbar'); -%>

<!-- Gradient Background -->
<section class="min-h-screen bg-gradient-to-r from-blue-500 to-purple-600 p-6">
    <div class="container mx-auto">
        <div class="flex justify-center">
            <div class="w-full max-w-4xl bg-white rounded-lg shadow-lg p-8">
                <h3 class="text-3xl font-bold text-center text-gray-800 mb-6">Student Profile</h3>

                <!-- Display Username & Role -->
                <h5 class="text-xl text-center text-gray-700 mb-6">Welcome, <%= username %> | Role: <%= role %></h5>

                <!-- Profile Image Display -->
                <div class="flex justify-center mb-8">
                    <img src="<%= profileImage %>" alt="Profile Image" class="rounded-full w-36 h-36 border-4 border-white shadow-md">
                </div>

                <form action="/profile" method="POST" enctype="multipart/form-data">
                    <input type="hidden" name="existingProfileImage" value="<%= profile ? profile.profileImage : '' %>">

                    <!-- Profile Image Upload -->
                    <div class="mb-6 p-6 bg-blue-50 rounded-lg border-2 border-blue-100">
                        <label class="block text-gray-700 text-lg font-semibold mb-2">Profile Picture</label>
                        <div class="flex items-center justify-center w-full">
                            <label class="flex flex-col items-center px-4 py-6 bg-white rounded-lg border-2 border-dashed border-blue-200 cursor-pointer hover:bg-blue-100">
                                <span class="text-blue-700 text-sm">Upload Profile Image</span>
                                <input type="file" class="hidden" name="profileImage" id="profileImage" accept="image/*">
                            </label>
                        </div>
                    </div>

                    <!-- Personal Details -->
<div class="mb-6 p-6 bg-purple-100 rounded-lg border-2 border-purple-300">
    <h5 class="text-xl font-semibold text-gray-800 mb-4">Personal Details</h5>
    <div class="space-y-4">
        <div>
            <label class="block text-gray-700 text-sm font-medium mb-1">Full Name</label>
            <input type="text" name="fullName" id="fullName" value="<%= profile && profile.fullName ? profile.fullName : username %>" class="w-full px-4 py-2 bg-white rounded-lg text-gray-700 focus:outline-none focus:ring-2 focus:ring-purple-500">
        </div>
        <div>
            <label class="block text-gray-700 text-sm font-medium mb-1">Email</label>
            <input type="email" name="email" id="email" value="<%= profile ? profile.email : '' %>" class="w-full px-4 py-2 bg-white rounded-lg text-gray-700 focus:outline-none focus:ring-2 focus:ring-purple-500">
        </div>
        <div>
            <label class="block text-gray-700 text-sm font-medium mb-1">Phone Number</label>
            <input type="tel" name="phone" id="phone" value="<%= profile ? profile.phone : '' %>" class="w-full px-4 py-2 bg-white rounded-lg text-gray-700 focus:outline-none focus:ring-2 focus:ring-purple-500">
        </div>
    </div>
</div>

<!-- Location Details -->
<div class="mb-6 p-6 bg-blue-100 rounded-lg border-2 border-blue-300">
    <h5 class="text-xl font-semibold text-gray-800 mb-4">Location Details</h5>
    <div class="space-y-4">
        <div>
            <label class="block text-gray-700 text-sm font-medium mb-1">State</label>
            <input type="text" name="state" id="state" value="<%= profile ? profile.state : '' %>" class="w-full px-4 py-2 bg-white rounded-lg text-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500">
        </div>
        <div>
            <label class="block text-gray-700 text-sm font-medium mb-1">District</label>
            <input type="text" name="district" id="district" value="<%= profile ? profile.district : '' %>" class="w-full px-4 py-2 bg-white rounded-lg text-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500">
        </div>
    </div>
</div>

<!-- Education Details -->
<div class="mb-6 p-6 bg-indigo-100 rounded-lg border-2 border-indigo-300">
    <h5 class="text-xl font-semibold text-gray-800 mb-4">Education Details</h5>
    <div class="space-y-4">
        <div>
            <label class="block text-gray-700 text-sm font-medium mb-1">College Name</label>
            <input type="text" name="collegeName" id="collegeName" value="<%= profile ? profile.collegeName : '' %>" class="w-full px-4 py-2 bg-white rounded-lg text-gray-700 focus:outline-none focus:ring-2 focus:ring-indigo-500">
        </div>
        <div>
            <label class="block text-gray-700 text-sm font-medium mb-1">Course</label>
            <input type="text" name="course" id="course" value="<%= profile ? profile.course : '' %>" class="w-full px-4 py-2 bg-white rounded-lg text-gray-700 focus:outline-none focus:ring-2 focus:ring-indigo-500">
        </div>
        <div>
            <label class="block text-gray-700 text-sm font-medium mb-1">Year</label>
            <input type="text" name="year" id="year" value="<%= profile ? profile.year : '' %>" class="w-full px-4 py-2 bg-white rounded-lg text-gray-700 focus:outline-none focus:ring-2 focus:ring-indigo-500">
        </div>
    </div>
</div>

<!-- Parent Linking -->
<div class="mb-6 p-6 bg-sky-100 rounded-lg border-2 border-sky-300">
    <h5 class="text-xl font-semibold text-gray-800 mb-4">Parent Linking</h5>
    <div class="space-y-4">
        <div>
            <label class="block text-gray-700 text-sm font-medium mb-1">Parent Linking Code</label>
            <input type="text" id="uniqueCode" value="<%= profile?.uniqueCode || '' %>" class="w-full px-4 py-2 bg-white rounded-lg text-gray-700 focus:outline-none focus:ring-2 focus:ring-sky-500" readonly>
            <% if (!profile?.uniqueCode) { %>
                <button type="button" id="generateCodeBtn" class="mt-2 px-4 py-2 bg-sky-500 text-white rounded-lg hover:bg-sky-600 focus:outline-none focus:ring-2 focus:ring-sky-500">Generate Code</button>
            <% } %>
            <small class="block text-gray-500 mt-2">Share this code with your parent to link their account.</small>
        </div>
    </div>
</div>


                    <!-- Save Button -->
                    <div class="flex justify-center mt-8">
                        <button type="submit" class="px-8 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500">Save Profile</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</section>

<script>
    document.getElementById("generateCodeBtn")?.addEventListener("click", async function() {
        try {
            const response = await fetch("/profile/generate-code", { method: "POST" });
            const data = await response.json();
            if (data.success) {
                document.getElementById("uniqueCode").value = data.uniqueCode;
                document.getElementById("generateCodeBtn").style.display = "none";
            } else {
                alert("Error generating code.");
            }
        } catch (error) {
            console.error("Error:", error);
            alert("An error occurred.");
        }
    });
</script>

<%- include('layouts/footer'); -%>